---
layout: '../../layouts/MarkdownPost.astro'
title: '[Linux] 网络概述'
pubDate: 2023-04-23
description: ''
author: '七月.cc'
cover:
    url: 'https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424103525580.png'
    square: 'https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424103525580.png'
    alt: 'cover'
tags: ["Linux", "网络"]
theme: 'light'
featured: false
---

![ ](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424103525580.png)

---

Linux的相关介绍, 从本篇文章开始 就要进入网络部分了. 

之前关于Linux介绍的内容都是系统编程方面的. 不过介绍系统, 其实基本都是为介绍网络做铺垫.

本篇文章先介绍一下有关网络要涉及的部分内容, 先了解一下网络. 

# Linux 网络概述

从网络的初始形态出现开始, 到现在已经发展了60年左右. 我们都知道, 网络最常用的功能就是实现多计算机之间的通信和数据传输.

那么, 在网络出现之前 计算机之间怎么实现数据传输呢？

## 网络发展

其实在网络没有出现之前, 多个计算机是无法直接数据传输的. 不像现在, 我们可以通过网页、软件……实现数据的传输和通信.

### 独立模式

网络出现之前, 计算机之间都处于一种独立的状态, 没有丝毫的联系.

如果存在三台计算机A、B、C, 各自有不同的功能和数据, 一个业务需要通过这三台计算机处理.

处理业务需要从A到C的顺序进行处理, 那么当A处理完之后, 需要将业务数据传输到B继续处理, B处理完之后, 又需要将业务数据传输到C做处理.

那么, 业务在计算机中处理完成之后, 就需要将业务数据从计算机中拿出来, 再传输到另一台计算机中. 也就是说 需要一个可以存储数据的中间媒介,  就像我们现在使用的U盘、移动硬盘等可以存储数据的硬件. 这样才能完成数据再不同计算机之间的传输.

![ ](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424114812249.png)

如果多台计算机之间总是需要数据的传输, 这样的方式毫无疑问是非常的麻烦的. 

那么就有人提出, 可不可以将计算机连接起来, 方便传输数据呢？

这就出现了网络的最初形态. 

### 网络互联

在介绍最初形态的网络之前, 我们重新了解一下计算机的结构, 进而理解一下`网络`

我们知道, 目前绝大多数计算机的结构都是按照 `冯诺依曼体系` 设计的.

也就是说, 我们计算机一般都可以看作 存储器-输入输出设备-中央处理器 组成的.

而我们明白, 计算机内部的各种硬件之间也是需要数据交互的, 而它们之间的交互其实就是通过 主板中的连接各硬件的线路来交互的.

![|wide](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424155848181.png)

如果将上图看作是一个计算机的结构简略图, 那么, 它们之间的连接线, 就可以看作是主板上连接各设备的线路.

这是一台计算机内部的体系结构. 一台计算机内部就存在许多的设备和连接线路, 并且设备之间可以通过这些线路来进行数据交互. 

那么, 可不可以将两台计算机也通过线路连接起来呢？只要将不同 `计算机之间也通过线路连接起来`, 不就有了不同计算机之间 `数据交互的可能性` 了吗？ 

假如, 计算机中的存在一个叫网卡的输入输出设备, 我们通过 `"一根线"` 将两台计算机中的`网卡设备连接起来`, 让两台计算机可以通过网卡`进行数据交互`. 那么, 这跟线其实就可以看作 `"网线"`. 那么 其实就可以将 这两台通过网线连接起来的计算机`看作`一个 只有两台计算机的 `"网络"`.

既然, 两台计算机通过线路连接起来, 进而可以传输数据, 可以看作 `"网络"`. 

那么, 一台`计算机内部的设备`其实都是`通过不同的线路相连接`起来的, 并且可以相互传输数据, 那么 也同样可以将 **`计算机内部的结构看作为一个小型的网络结构`** 

那么, 再回过头来看两台计算机相连接, 其实就是将两台计算机其中的`网卡设备连接起来`了, 只不过 这里的线要`比`一个`计算机内部的设备之间相连接的线要长`的多. 

---

根据计算机内部的各设备相连接的情况. 我们可以以类似的方式将多个不同的计算机的网卡设备相连接起来, 以实现多计算机之间数据交互的功能.

![ ](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230424172530267.png)

计算机`内部设备之间连接的线`比较`短`, 且比较`密集`.  在实际中, 这些线传输数据 可能相互之将会造成一定的干扰.

而 连接不同计算机的线就相对较`长`, 没有那么密集, 一般情况下不会出现不同的线互相干扰的情况, 或干扰不强. 但是, 长线有长线的问题：

1.  **`可靠性`**, 即 如何能保证数据在长线中传输时, 不会发生数据丢失或损坏等问题呢？如果发生了怎么样弥补呢？
2.  **`效率`**, 即 如何保证数据在长的线中传输的速度要快一些呢？
3.  **`如何寻找到对方`**, 即 这么长的线, 如何找到传输数据的目的方呢？

其实网络知识基本上都是围绕 `线太长会出现的问题` 展开的~

小型的网络就是这样形成的. 

### 局域网LAN 和 广域网WAN

当需要连接的计算机越来越多、整个网络越来越大时, 就诞生出了一些设备：`交换机`、`路由器`等

`交换机`, 通常用于在 `同一个计算机网络中连接多个设备`, 并通过网络协议来实现数据的传输和交换. 因为计算机太多连接会出现一些问题, 交换机可以减少的出现的问题, 比如 安全性、传输效率等问题.

`路由器`, 当不同的计算机网络之间也需要交换数据时, 就需要使用路由器, 将不同的计算机网络之间连接起来. 交换机会根据`不同网络的网络协议来实现数据包的转发`. 实现网络之间的通信.

当网络之间通过交换机、路由器连接起来形成更大的网络, 局域网就诞生了.

一般来说, 局域网不会太大. 我们上面举的几个计算机直接连接在一起的例子, 也可以称为一个局域网.

更大的网络就是, 广域网WAN等.

## 认识 "协议"

协议是什么？在生活中, 协议其实就是一种约定, 而在网络的世界. 其实协议也是一种约定.

我们可以举一个`生活中的单的例子` 来解释一下什么是协议. 

比如在学生时期 课堂上的小测试, 你和你的朋友可能会设置一些手势来传递问题的答案. 比如, 问方: 先用手势表示题号; 回答方: 用手势表示会不会做, 然后再用手势表示答案选什么……

这些手势肯定不是上课测验时才想出来的, 肯定是你跟朋友`早就约定好的`. 这些约定好的 什么手势表示什么内容, `其实就是一种协议`.

在计算机中同样如此. 计算机内部设备传输数据传输的都是二进制数据, 如果各设备之间不对二进制数据约定好读取、发送的协议, 那么就没有办法正常的发送、获取数据. 

网络同样如此, `在网络上, 不同计算机传输的数据也是以二进制的形式传输的`, 但是 二进制的形式可能有所不同：有些可能用 频率的强弱来表示10, 有些可能使用信号的波峰波谷来表示10. 即 不同的主机之间虽然都是二进制的形式传输信息. 但是由于**`表示的形式不同, 这些二进制数据就不一定可以被正确、正常的读取到`**.

所以, 在传输数据时, 就需要提前约定好双方的数据格式. 

但是, **`只约定好数据格式, 是不能做好不同主机之间的通信的`**. 

举一个生活大家都听过、玩过的一个游戏的例子: 萝卜蹲

萝卜蹲的游戏规则非常的简单：约定好每个人是什么萝卜, 然后被点到名字的萝卜的要做萝卜蹲, 并点名其他萝卜蹲.

这个`游戏规则`其实就制定了一个传递`数据的格式`, 每个人都要做动作且点其他人的名. 一般来说, 这么简单的游戏规则 大家都可以听得懂.

但是, 如果`6个人一起玩`, `5个人都是说中文`, 但是有`一个人说法语、日语或者其他可能听不懂的语言`. `别人怎么玩`？

所以, 要 `实现主机间正常的通信`, 其实 **`除了约定好数据格式之外, 还需要遵守制定好的标准`**.

为什么呢？

1. 计算机生产厂商有很多
2. 计算机操作系统, 也有很多
3. 计算机网络硬件设备, 还是有很多

计算机生产厂商多, 每家厂商的计算机内部实现数据通信的方式就可能不同.

操作系统多, 不同的操作系统内部数据的表现形式就也可能不同.

网络硬件设备多, 不同的设备也可能会存在一些大大小小的差异.

为了确保不同厂商、操作系统、网络硬件的主机之间可以正常的通信, 就需要 **`制定出一个可以让所有的厂商、操作系统、网络硬件同一约定的标准`**.

这个标准, 就可以被称为 **`网络协议`**. 网络协议, 一般包括了数据传输的格式、传输速率、错误检测与纠正等方面的规定. 以方便数据的传输、主机的通信.

## 协议的分层

关于分层, 其实学习C/C++ 和 Linux 的过程中, 我们已经解除了许多分层的概念：

比如, C++ 默认实现了类, 可以实现类内函数, 通过实例化对象来调用类内函数. 但是C语言默认 `不支持在结构体内定义成员函数`

虽然C语言不支持在结构体内部定义成员函数, 不过我们可以通过 函数指针 在函数内部定义指针变量, 来实现通过结构体变量 执行结构体所包含的函数 的功能. 这就是一种软件分层

还有我们在介绍Linux 进程时, 我们介绍了 `进程地址空间` 的概念. 在介绍Linux文件系统时, 我们介绍了 `file_struct` 知道了Linux中一切皆文件. 这两种 实现形式其实都是软件分层的一种实现. 系统是一层, 中间是一层, 还有上层的软件或底层硬件又是一层.

通过这样的对软件的分层有许多的优点:

1. 对软进行分层的同时, 其实也对软件的问题进行了归类.

	进行分层之后, 其实已经将不同层的问题分开了, 因为 不同层之间基本上就是调用与被调用的关系. 当某个功能出现问题之后, 可以通过定位功能的实现层级来确定问题的出现层级, 可以进一步定位问题.

2. 软件分层其实本质上就是: 软件上的解耦

	软件分层之后, 层与层之间是调用与被调用之间的关系, 就将不同的功能之间进行了解耦

3. 软件分层 也可以便于我们 进行代码分析

软件是可以分层的, 也存在一些优点. 

而 事实上, 网络的本身的代码就是层状结构的. 那么对应的 `网络协议其实也是分层的`

那么如何理解简单的理解网络协议分层呢?

在生活中, 我们每个人一定都打过电话, 我们就可以通过 `打电话` 这个例子来简单的理解一下 `协议的分层`

我们每个人打电话交流时, 一定都是 `用相同的语言来交流` 的. 如果使用不同的语言 很可能就无法交流.

并且, 我们在打电话时, `打电话的人会认为 自己是与对方直接通信的`.

而 实际上, 所谓的直接通信是并不存在的.

我们打电话交流使用同一种语言 就可以看作 在人的层面使用一种语言协议来进行通信

而 我们知道, 打电话交流时 我们说话声音传输到通讯设备中时其实是一种 `模拟信号`, 但是数据传输需要 `数字信号`.

我们打电话实现交流 其实是 先将模拟信号转化为数字信号, 然后 `数字信号再在通讯设备之间传输` 的.

那么 我们就可以将打电话的过程最简单的看作是两个层级: 

1. 人, 用户层级. 人与人之间通过一定的语言(协议)进行通信.
2. 设备层级. 设备之间通过一定的协议 传输数字信号.

那么, 为什么我们打电话的时候 会认为 自己会与对面的人直接通信的呢?

其实是因为, 我们打电话时 **不会去关注中间的数据** 是以怎么样的形式存在 是以什么样的方式传输的.

同理, 设备之间传输数据时, 也不会在意打电话的人说的是什么语言, 说的语速多多快. 

所以 打电话时 才会看作 `人是与人通信的`. 那么 同理, 其实也可以看作 `设备是与设备通信的.`

以这样的视角来看, 其实可以进一步看作: **`同层协议设备之间直接通信, 可以忽略底层的网络.`**

**`这也就是 网络协议是分层的. 那么, 不同层就需要有自己的协议.`**

分层之后, 不同层级之间进行数据传输只需要 `调用不同层级提供的接口` 就可以了, 不需要关注底层是如何实现的.

那么既然网络协议是分层的, 那么 协议一共多少层呢? 每层的内容又是什么呢?

下面, 就来介绍一下 **`网络协议栈`** 的内容.

## 网络协议栈

### OSI七层模型

OSI（Open System Interconnection，开放系统互连）七层网络模型称为 **开放式系统互联参考模型**, 是一个 **逻辑** 上的定义和规范

OSI 七层模型把网络从逻辑上分为了7层. 每一层都有相关、相对应的物理设备，比如路由器，交换机;

OSI 七层模型是一种 **框架性的设计方法**，其最主要的功能使就是帮助不同类型的主机实现数据传输;

它的最大优点是将服务、接口和协议这三个概念明确地区分开来，概念清楚，理论也比较完整. 通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯;

| 层级 |   分层名   | 功能                                                         |                           功能概述                           |
| :--: | :--------: | :----------------------------------------------------------- | :----------------------------------------------------------: |
|  7   |   应用层   | 针对特定应用的协议                                           | 针对每个应用的协议<br />电子邮件 <----> 电子邮件协议<br />远程登录 <----> 远程登录协议<br />文件传输 <----> 文件传输协议 |
|  6   |   表示层   | 设备固有数据格式和网络标准数据格式的转换                     | ![\|inline](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230514214101169.png)<br />接收不同表现形式的信息, 如 文字流 图像 声音等 |
|  5   |   会话层   | 通信管理. 负责建立和断开通信连接(数据流动的逻辑通路). 管理传输层一下的分层 |         何时建立连接? 何时断开连接以及保持多久连接?          |
|  4   |   传输层   | 管理两个节点之间的数据传输. 负责可靠传输(确保数据被可靠的传送到目的地址) |                      是否发生数据丢失?                       |
|  3   |   网络层   | 地址管理与路由选择                                           | ![ \|inline](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230514214616779.png)<br />经过哪个路由传递到目的地址? |
|  2   | 数据链路层 | 互联设备之间传送和识别数据帧                                 | ![\|inline](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230514215017696.png)<br />数据帧与比特流之间的转化<br />![\|inline](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230514215322512.png) |
|  1   |   物理层   | 以 **'0'** **'1'** 表示电压的高低 灯光的闪灭. 界定连接器和网线的规格 | ![\|inline](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230514220737747.png)<br />比特流与电子信号之间的转换<br />连接器与网线的规格 |

OSI 七层模型在框架上 逻辑设计上 是十分的优秀的. 

七个层次, 每个层次都有特定的功能和责任, 这种层次结构 `使得网络设计和实现更加模块化和可控`. 不同层级之间更加独立, `方便扩展与更新`. 可以根据不同层级的功能和责任, `快速定位错误 问题`.

并且, OSI 七层模型更是 ISO组织制定的一种描述网络协议和服务的标准. 

但是, 存在一个问题就是, 在实际的软件 网络服务开发中. 如果完全按照OSI七层模型进行开发, 实际上是不方便的.

由于制定标准和实际开发的人员并不是同一批人. 而 实际开发的具体情况 是不可能在定制标准的时候就制定好的.

比如会话层, 会话层主要负责 通信在何时建立, 何时断开的问题. 但是 通信的建立和断开 实际上绝大多数情况都是根据具体的业务来设定的. **底层指定的协议是做不到对上层业务的完全支持的** 

还有表示层和应用层. 由于业务的不同, 表示层的数据转换也不是固定的, 应用层所使用的特定的协议也是多种多样的.

这上三层的协议, 在操作系统的底层中是不能非常统一的实现的. 所以 **操作系统底层中协议一般包含网络层和传输层**.

数据链路层则是由驱动进行支持. 上三层的协议是业务开发时, 具体设计的协议.

所以 在实际的开发中, 并不会使用 OSI七层模型. 而是使用另一种模型: **`TCP/IP 五层(四层)模型`**

### TCP/IP五层(四层)模型

TCP/IP实际上是一组协议的代名词, 它包括许多的协议. 组成了 TCP/IP 协议簇.

TCP/IP 通讯协议采用了 5层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求.

> - **`物理层:`** `负责光/电信号的传递方式`. 比如现在以太网通用的网线(双绞 线)、早期以太网采用的的同轴电缆(现在主要用于有线电视)、光纤, 现在的wifi无线网使用电磁波等都属于物理层的概念。物理层的能力决定了最大传输速率、传输距离、抗干扰性等. 集线器(Hub)工作在物理层.
> - **`数据链路层:`** `负责设备之间的数据帧的传送和识别`. 例如网卡设备的驱动、帧同步(就是说从网线上检测到什么信号算作新帧的开始)、冲突检测(如果检测到冲突就自动重发)、数据差错校验等工作. 有以太网、令牌环网, 无线LAN等标准. 交换机(Switch)工作在数据链路层.
> - **`网络层:`** `负责地址管理和路由选择`. 例如在IP协议中, 通过IP地址来标识一台主机, 并通过路由表的方式规划出两台主机之间的数据传输的线路(路由). 路由器(Router)工作在网路层.
> - **`传输层: `** `负责两台主机之间的数据传输`. 如传输控制协议 (TCP), 能够确保数据可靠的从源主机发送到目标主机.
> - **`应用层: `** `负责应用程序间沟通`，如简单电子邮件传输（SMTP）、文件传输协议（FTP）、网络远程访问协议（Telnet）等. 我们的网络编程主要就是针对应用

即使TCP/IP网络协议栈是 5层的, 但是也可以对应 OSI七层模型:

![|wide](https://dxyt-july-image.oss-cn-beijing.aliyuncs.com/CSDN/image-20230515224404521.png)

而一般网络开发的情况下, 物理层考虑的比较少. 因此很多时候也可以称为 **`TCP/IP四层模型`**

一般而言

> - 对于一台 **`主机`**, 它的操作系统内核实现了 **传输层到物理层** 的内容;
> - 对于一台 **`路由器`**, 它实现了从 **网络层到物理层**;
> - 对于一台 **`交换机`**, 它实现了从 **数据链路层到物理层**;
> - 对于 **`集线器`**, 它只实现了 **物理层**;

但是并不绝对. 很多交换机也实现了网络层的转发; 很多路由器也实现了部分传输层的内容(比如端口转发);
