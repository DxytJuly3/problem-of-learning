# 2022-02-21 文件操作(1)

## 一. 文件的分类

文件按照功能，区分为两类：程序文件、数据文件

两种文件类型的区分是相对的，并不是绝对的

1. 程序文件

   > 比如：C语言的源程序文件( `.c` 为后缀的文件 )
   >
   > ​		   目标文件( 在Windows环境中 以 `.obj` 为后缀 )
   >
   > ​		   可执行程序文件( 在Windows环境中 以 `.exe` 为后缀 )
   >
   > ​		   等等

2. 数据文件

   > 数据文件的内容，不一定是程序。可以是程序运行时所需要读取、改变的数据。

为什么说两种文件类型的区分是相对的？

> 比如：
>
> 存在两个源文件	`test1.c`	`test2.c`
>
> 如果 `test1.c` 文件可以对 `test2.c` 文件中的数据进行读取等操作，那么`test1.c` 就是程序文件，`test2.c` 就是数据文件。

---

PS：以下讨论的均为数据文件

---

## 二. 文件的操作

### 2.1  文件指针

在学习文件指针之前，首先我们来了解一个概念：文件信息区

文件信息区：

> 每次打开一个文件，计算机都会在内存中开辟一块区域来存放该文件的各种信息(比如文件名、文件的状态、文件的地址、文件的大小等)。
>
> 这些信息都存放在一个结构体变量中，此结构体变量的类型默认被系统声明为 `FILE`。所以，被使用文件的文件信息区，本质上就是一个`FILE` 类型的结构体变量。
>
> 每当一个文件打开后，计算机会自动根据文件的状态、情况自动生成一个`FILE`类型的结构体变量，并存入该文件的各种信息。 

>`FILE` 类型的具体成员，内容。在不同的编译器中是不完全相同的，但是差别不大

我们使用 `FILE` 类型定义的结构体指针变量，就是一个文件指针变量

```c
FILE* pf	//pf 文件指针变量
```

定义 `pf` 是一个指向 `FILE` 类型数据的指针变量，可以指向某个文件的文件信息区，通过文件信息区中存放的信息可以进一步访问该文件。`所以，通过文件指针变量能够找到与其相关联的文件。`

### 2.2  文件的打开与关闭

文件的打开操作及关闭操作，需要使用两个函数 `fopen(文件打开函数)` 及 `fclose(文件关闭函数)`

#### `fopen`

```c
FILE* fopen( const char *filename, const char *mode );
```

> 第一个参数 `filename`，应该传入 需打开文件的文件名
>
> 尽量详细需要打开的文件名，如：`C:\\Program Files\\TEST.c`
>
> 若只传入	`TEST.c`，只会默认打开（创建）`.c` 文件所在路径的 `TEST.c` 文件

> 第二个参数 `mode`，应该传入 表示文件打开模式（方式）的字符串
>
> 具体的模式有：
>
> >  表示读写权限的：
> >
> >  | 字符串 |  权限  |                             说明                             |
> >  | :----: | :----: | :----------------------------------------------------------: |
> >  | `"r"`  | `只读` |     只允许读取，不允许写入。文件必须存在，否则打开失败。     |
> >  | `"w"`  | `写入` |  若文件不存在，则创建一个新文件；若文件存在，则清空文件内容  |
> >  | `"a"`  | `追加` | 若文件不存在，则创建一个新文件；若文件存在，则将写入的数据追加到文件的末尾 |
> >  | `"r+"` | `读写` |       既可以读取也可以写入。文件必须存在，否则打开失败       |
> >  | `"w+"` | `写入` | 既可以读取也可以写入。若文件不存在，则创建一个新文件；若文件存在，则清空文件内容 |
> >  | `"a+"` | `追加` | 既可以读取也可以写入。若文件不存在，则创建一个新文件；若文件存在，则将写入的数据追加到文件的末尾 |
> >
> >  表示读写方式的：
> >
> >  | 字符串 |          说明          |
> >  | :----: | :--------------------: |
> >  | `"t"`  |  以文本文件方式读写。  |
> >  | `"b"`  | 以二进制文件方式读写。 |
> >
> >  其实，文件打开方式由 r、w、a、t、b、+ 六个字符拼成，各字符的含义是：
> >
> >  - `r(read)`：读取
> >  - `w(write)`：写入
> >  - `a(append)`：追加
> >  - `t(text)`：文本文件
> >  - `b(binary)`：二进制文件
> >  - `+`：读取和写入
>
> 第二个参数 `mode` ，传参时，其实 读写权限和读写方式 是结合使用的（但必须将 读写方式 放在 读写权限 的中间或者尾部），不过 读写方式可以忽略不写（忽略的情况下，默认为 `"t"`，即默认以文本文件的方式进行读写）
>
> > 读写权限 及 读写方式 的结合使用，例：
> >
> > 读写方式放在读写权限的尾部 `"rt"`、`"rb"`、`"r+t"`、`"r+b"`、`"wt"`、`"w+b"`、`"at"`等等
> >
> > 读写方式放在读写权限的中间 `"rt+"`、`"rb+"`、`"wt+"`、`"wb+"`等等

`fopen` 函数的返回值 是 `FILE*` 类型的，返回的是所打开的文件的文件信息区的首地址，所以需要用 `FILE*` 类型的指针变量接收，然后可以通过此指针变量操作此文件信息。

#### `fclose`

```c
int fclose( FILE* stream );
```

> 参数的类型是 `FILE*` 的指针变量，此指针变量 需指向 已打开文件的文件信息区的地址
>
> 例如
>
> ```C
> #include <stdio.h>
> int main ()
> {
>     //打开文件
> 	FILE * pf = fopen ("test.txt","w");
> 	if (pf != NULL)
> 	{
> 	//文件操作
>         //…………
> 	//关闭文件
> 		fclose (pf);
>         pf = NULL;
> 	}
> 	return 0;
> }
> ```
>
> 
